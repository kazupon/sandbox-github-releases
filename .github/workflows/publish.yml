name: Publish

on:
  release:
    types:
    - published

env:
    GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}

jobs:
  publish:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
        with:
          ref: ${{ github.head_ref }}
      - name: Genearte changelog
        run: |
          gh release view --json createdAt,tagName,name,url,publishedAt,body --template \
          '# {{.name }}{{if ne .tagName .name }} {{.tagName}}{{ end }} ({{ .publishedAt }})

          This changelog is generated by [GitHub Releases]({{.url}})

          {{ .body }}' > ./CHANGELOG.md
      - name: Check content
        run: cat ./CHANGELOG.md
      - uses: stefanzweifel/git-auto-commit-action@v4
        with:
          branch: main
          file_pattern: "*.md"
          commit_message: "chore: generate changelog"
      - name: Publish
        run: |
          # npm publish
          echo 'npm publish!'
