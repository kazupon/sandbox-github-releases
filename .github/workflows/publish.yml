name: Publish

on:
  release:
    types:
    - published

env:
    GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}

jobs:
  publish:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Genearte changelog
        run: |
          gh release view --json createdAt,tagName,name,url,publishedAt,body --template \
          '# {{.name }}{{if ne .tagName .name }} {{.tagName}}{{ end }} ({{ .publishedAt }})

          This changelog is generated by [GitHub Releases]({{.url}})

          {{ .body }}' > ./CHANGELOG.md
      - name: Check content
        run: echo ./CHANGELOG.md
      - name: Commit changelog
        run: |
          git add ./CHANGELOG.md
          git commit -m "chore: generate changelog"
          git push origin
      - name: Publish
        run: |
          # npm publish
          echo 'npm publish!'
